<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>For My Pri ‚ù§Ô∏è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>

<!-- HEARTBEAT AUDIO -->
<audio id="heartbeatAudio" loop preload="auto">
    <source src="{{ url_for('static', filename='heartbeat.wav') }}" type="audio/wav">
</audio>

<main style="min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem;">

<!-- STAGE 1 -->
<section id="stage1" class="stage active card float">
    <img src="https://media.giphy.com/media/v49K3D2fF9V6E/giphy.gif" height="150">
    <h1 style="color:#fb7185;font-size:2.6rem;margin:1.4rem 0;">Hi Pri‚Ä¶ ‚ú®</h1>
    <button class="btn-rose" onclick="nextStage(2)">Hi üëã</button>
</section>

<!-- STAGE 2 -->
<section id="stage2" class="stage card">
    <h2 style="color:#fb7185;font-size:2.1rem;">How are you today, beautiful?</h2>
    <div style="margin-top:1.6rem;display:flex;flex-direction:column;gap:1rem;">
        <button class="btn-green" onclick="nextStage(3)">I‚Äôm doing great üòä</button>
        <button class="btn-gray" onclick="sadMode()">A bit tired üòî</button>
    </div>
</section>

<!-- STAGE 3 -->
<section id="stage3" class="stage card">
    <img id="moodImg" src="https://media.giphy.com/media/L95W4wv8nnb9Brq2S2/giphy.gif" height="140">
    <p id="moodText" style="margin:1.6rem 0;font-style:italic;">
        I was thinking about the <b>Psychology of Money</b> book you got me‚Ä¶
        It made me realize that logic matters, but love is about <b>you</b>.
    </p>
    <button class="btn-rose" onclick="nextStage(4)">Continue ‚ù§Ô∏è</button>
</section>

<!-- STAGE 4 -->
<section id="stage4" class="stage card">
    <h1 style="color:#fb7185;font-size:2.4rem;">Will you be my Valentine? üåπ</h1>

    <div style="margin-top:2rem;position:relative;height:120px;">
        <button id="yesBtn" class="btn-green" onclick="celebrate()">Yes!</button>
        <button id="noBtn" class="btn-rose" onmouseover="moveNo()" onclick="moveNo()">No</button>
    </div>
</section>

<!-- FINAL -->
<section id="finalStage" class="stage card" style="max-width:700px;">
    <img src="https://media.giphy.com/media/igS6K9F5zD3pT957g0/giphy.gif" height="160">
    <h1 style="color:#fb7185;font-size:3rem;">She said YES ‚ù§Ô∏è</h1>

    <p style="font-weight:600;color:#fb7185;">5 reasons why I love you:</p>

    <div style="display:grid;gap:1rem;margin-top:1.5rem;">
        <div class="reason">Your thoughtfulness ‚Äî like that book.</div>
        <div class="reason">Your smile ‚Äî instant reset.</div>
        <div class="reason">Your support ‚Äî my peace.</div>
        <div class="reason">Our conversations ‚Äî finance to nonsense.</div>
        <div class="reason">Just you ‚Äî irreplaceable.</div>
    </div>

    <p class="signature">
        This page exists only for you.<br>
        Built with love ‚Äî by MENE.
    </p>
</section>

</main>

<script>
let currentStage = 1;

/* HEARTBEAT AUDIO */
const heartbeat = document.getElementById("heartbeatAudio");
let heartbeatEnabled = false;

function enableHeartbeat() {
    if (heartbeatEnabled) return;
    heartbeat.volume = 0.15;
    heartbeat.play().catch(()=>{});
    heartbeatEnabled = true;
    document.removeEventListener("click", enableHeartbeat);
    document.removeEventListener("touchstart", enableHeartbeat);
}

document.addEventListener("click", enableHeartbeat);
document.addEventListener("touchstart", enableHeartbeat);

function pulseHeartbeat(intensity = 0.25) {
    if (!heartbeatEnabled) return;
    heartbeat.volume = Math.min(intensity, 0.35);
    document.body.classList.add("heartbeat-pulse");
    setTimeout(() => {
        heartbeat.volume = 0.15;
        document.body.classList.remove("heartbeat-pulse");
    }, 400);
}

/* STAGE NAV */
function nextStage(n) {
    pulseHeartbeat(0.25);
    document.getElementById(`stage${currentStage}`).classList.remove("active");
    document.getElementById(`stage${n}`).classList.add("active");
    currentStage = n;
}

function sadMode() {
    pulseHeartbeat(0.22);
    document.getElementById("moodText").innerHTML =
        "I hate that you‚Äôre tired‚Ä¶ but I hope this reminds you how deeply I care ‚ù§Ô∏è";
    document.getElementById("moodImg").src =
        "https://media.giphy.com/media/d7rvF20PqNuGKSQGgc/giphy.gif";
    nextStage(3);
}

/* NO BUTTON */
function moveNo() {
    pulseHeartbeat(0.3);
    const no = document.getElementById("noBtn");
    const yes = document.getElementById("yesBtn");

    const maxX = window.innerWidth - no.offsetWidth - 20;
    const maxY = window.innerHeight - no.offsetHeight - 20;

    no.style.left = Math.random() * maxX + "px";
    no.style.top = Math.random() * maxY + "px";

    const scale = parseFloat(yes.dataset.scale || 1) + 0.15;
    yes.dataset.scale = scale;
    yes.style.transform = `scale(${scale})`;
}

/* FINAL */
function celebrate() {
    pulseHeartbeat(0.35);
    localStorage.setItem("priSaidYes", "true");
    document.getElementById(`stage${currentStage}`).classList.remove("active");
    document.getElementById("finalStage").classList.add("active");
}

/* MEMORY */
if (localStorage.getItem("priSaidYes")) {
    document.getElementById("stage1").classList.remove("active");
    document.getElementById("finalStage").classList.add("active");
}
</script>

</body>
</html>
